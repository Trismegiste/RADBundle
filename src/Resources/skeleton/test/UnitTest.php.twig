<?php
/**
 * Unit testing for {{ fqcnEntity }}
 * Scaffolded by TrismegisteRADBundle 
 * 
 */
 
use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;
use {{ fqcnEntity }};

class {{ test_class }} extends WebTestCase
{

    protected $object = null;
    protected static $validator = null;

    public static function setUpBeforeClass()
    {
        self::$kernel = parent::createKernel();
        self::$kernel->boot();

        self::$validator = self::$kernel->getContainer()->get('validator');
    }
    
    protected function setUp()
    {
        $this->object = new {{ entity }}();
    }

    public function getBooleanValues()
    {
        return array( array(true, false) );
    }

    public function getStringValues()
    {
        return array( array('spock', 'tuvok') );
    }
    
    public function getTextValues()
    {
        return array( array('brown fox', 'lazy dog') );
    }    

    public function getIntegerValues()
    {
        return array( array(rand(1000, 9999), 42) );
    }

    public function getSmallintValues()
    {
        return $this->getIntegerValues();
    }
    
    public function getFloatValues()
    {
        return array( array(0.1  * rand(1000, 9999), 4.2) );
    }

    public function getDecimalValues()
    {
        return $this->getFloatValues();
    }
    
    public function getDatetimeValues() {
        $ajd = new \DateTime();
        $demain = clone $ajd;
        $demain->modify('+1 day');
        return array(array($ajd, $demain));
    }

    public function getDateValues()
    {
        return array( array('1973-05-05', '1995-04-01'));
    }

    public function getTimeValues()
    {
        return array( array('20:21:22', '12:34:56'));
    }

    {% for field in fields %}
    /**
     * Testing for {{ field.property }}
     *
     * @dataProvider get{{ field.type }}Values
     * @covers {{ entity }}::get{{ field.accessor }}
     * @covers {{ entity }}::set{{ field.accessor }}
     */
    public function test{{ field.accessor }}($setting, $notSetted)
    {
        $this->object->set{{ field.accessor }}($setting);
        $this->assertEquals($this->object->get{{ field.accessor }}(), $setting);
        $this->assertNotEquals($this->object->get{{ field.accessor }}(), $notSetted);
    }

    {% endfor %}

    /**
     * Test for assertions against a newly created {{ entity }}
     */
    public function testValidatorNudeObject()
    {
        $obj = new {{ entity }}();
        $error = self::$validator->validate($obj);
        $this->assertEquals(count($error), {{ nudeValidation|length }}, "List of violations differs");

        $expected = array();
        {% for search in nudeValidation %}
        $expected[] = array( 'property' => '{{ search.property }}', 'message' => "{{ search.message }}");
        {% endfor %}

        // check assertions
        foreach($expected as $search) {
            $found = false;
            foreach($error as $violation) {
                if ( ($violation->getMessageTemplate() == $search['message'])
                && ($violation->getPropertyPath() == $search['property']) ) {
                    $found = true;
                    break;
                }
            }
            $this->assertTrue($found, "Assert '{$search['message']}' not found on {{ entity }}::{$search['property']}");
        }

    }


    /**
     * Test for assertions against a correctly initialized {{ entity }}
     */
    public function testValidatedObject()
    {
        $obj = new {{ entity }}();
        // setting good values
        $this->initializeValid($obj);

        $error = self::$validator->validate($obj);
        $this->assertEquals(0, count($error), "{{ entity }} is difficulter to validate");
    }

    protected function initializeValid({{ entity }} $obj)
    {
        {% for search in nudeValidation %}
        //  {{ search.message }} : 
        $obj->set{{ search.accessor }}();   
        {% endfor %}    
    }
     
}
